# Example Scripts: Metric Type Checks

Manual check scripts for all 3 alert metric types, via both ingest transports:
- HTTP
- NATS

Scripts:
- `http_count_total.sh`
- `http_count_window.sh`
- `http_missing_heartbeat.sh`
- `nats_count_total.sh`
- `nats_count_window.sh`
- `nats_missing_heartbeat.sh`

## Prerequisites
- Service is running and ready.
- Rules for the target metric type exist and match tags/var sent by script.
- For NATS scripts: `nats` CLI installed and `ingest.nats.enabled=true`.

## Common env
- `BASE_URL` (default `http://127.0.0.1:8080`)
- `INGEST_PATH` (default `/ingest`)
- `NATS_URL` (default `nats://127.0.0.1:4222`)
- `NATS_SUBJECT` (default `alerting.events`)
- `TAG_DC` (default `dc1`)
- `TAG_SERVICE` (default `api`)
- `TAG_HOST` (default autogenerated `demo-<unixsec>`)
- `VAR` (metric name; defaults by scenario)
- `VALUE_N` (default `1`)

Timing env:
- `SILENCE_SEC` (count_total/count_window resolve wait; default `65`)
- `MISSING_SEC` (missing_heartbeat firing wait; default `12`)

Count window mode env:
- `EVENT_TYPE` (`event` or `agg`, default `event`)
- `BURST_EVENTS` (default `5`)
- `BURST_INTERVAL_SEC` (default `0.2`)
- `AGG_CNT` (used when `EVENT_TYPE=agg`, default `2`)
- `WIN_MS` (used when `EVENT_TYPE=agg`, default `10000`)

## Run examples

HTTP + count_total:
```bash
./docs/example/http_count_total.sh
```

NATS + count_window (agg mode):
```bash
EVENT_TYPE=agg AGG_CNT=3 WIN_MS=15000 ./docs/example/nats_count_window.sh
```

HTTP + missing_heartbeat:
```bash
VAR=heartbeat MISSING_SEC=20 ./docs/example/http_missing_heartbeat.sh
```

## Notes
- Scripts send events and wait expected transition windows.
- Verification is by your standard outputs (Telegram/logs/target channel).

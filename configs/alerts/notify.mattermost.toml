# ------------------------------------------------------------
# ALERTING: –ö–û–ù–§–ò–ì –ö–ê–ù–ê–õ–ê –î–û–°–¢–ê–í–ö–ò MATTERMOST
# –ó–¥–µ—Å—å —Ç–æ–ª—å–∫–æ transport-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã mattermost.
# –ö–∞–Ω–∞–ª —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ Mattermost REST API /api/v4/posts.
# ------------------------------------------------------------

[notify.mattermost]
# –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∫–∞–Ω–∞–ª Mattermost.
enabled = false
# –ë–∞–∑–æ–≤—ã–π URL Mattermost.
# –ü—Ä–∏–º–µ—Ä: https://mattermost.example
base_url = "https://mattermost.example"
# –¢–æ–∫–µ–Ω –±–æ—Ç–∞ Mattermost (—Å–µ–∫—Ä–µ—Ç), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Authorization: Bearer <token>.
bot_token = "replace-me"
# ID –∫–∞–Ω–∞–ª–∞ Mattermost, –∫—É–¥–∞ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è.
channel_id = "replace-me"
# –¢–∞–π–º–∞—É—Ç HTTP-–∑–∞–ø—Ä–æ—Å–∞ –∫ Mattermost API (—Å–µ–∫).
timeout_sec = 10

[notify.mattermost.retry]
# –ü–æ–ª–∏—Ç–∏–∫–∞ —Ä–µ—Ç—Ä–∞–µ–≤ –∏–º–µ–Ω–Ω–æ –¥–ª—è Mattermost —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞.

# –í–∫–ª—é—á–∏—Ç—å —Ä–µ—Ç—Ä–∞–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ –æ—Ç–ø—Ä–∞–≤–∫–∏.
enabled = true
# –ê–ª–≥–æ—Ä–∏—Ç–º –ø–∞—É–∑—ã –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏.
# –ü–æ–¥–¥–µ—Ä–∂–∞–Ω–æ: exponential (—Ä–æ—Å—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–æ max_ms).
backoff = "exponential"
# –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —Ä–µ—Ç—Ä–∞—è (–º—Å).
initial_ms = 500
# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —Ä–µ—Ç—Ä–∞—è (–º—Å).
max_ms = 60000
# –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫.
# 0 = –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ (–¥–æ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–∏—Å–∞).
max_attempts = 0
# –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—É—é –Ω–µ—É—Å–ø–µ—à–Ω—É—é –ø–æ–ø—ã—Ç–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏.
log_each_attempt = true

[[notify.mattermost.name-template]]
# –ò–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∫–∞–Ω–∞–ª–∞ Mattermost.
# –ù–∞ –Ω–µ–≥–æ —Å—Å—ã–ª–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª–∞ –≤ [[rule.<rule_name>.notify.route]].template.
name = "mm_default"
# –¢–µ–ª–æ —Å–æ–æ–±—â–µ–Ω–∏—è (Go text/template, missingkey=error).
# –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–ª—è: .RuleName .State .Var .MetricValue .StartedAt .Duration .ShortID ...
message = '''
{{- if eq .State "firing" -}}
‚òùÔ∏è {{ .RuleName }} ({{ .ShortID }})
{{ .Var }}: {{ .MetricValue }}
–ù–∞—á–∞–ª–æ: {{ .StartedAt.Format "15:04" }}
{{- else if eq .State "resolved" -}}
üëç {{ .RuleName }} ({{ .ShortID }})
{{ .Var }}: {{ .MetricValue }} (OK)
–ù–∞—á–∞–ª–æ: {{ .StartedAt.Format "15:04" }}
–î–µ–ª—å—Ç–∞: {{ fmtDuration .Duration }}
{{- end -}}
'''

# –õ–æ–≥–∏–∫–∞ threading:
# - firing —Å–æ–∑–¥–∞–µ—Ç post –∏ –µ–≥–æ post.id —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ —Å—Å—ã–ª–∫–∞ –∫–∞–Ω–∞–ª–∞.
# - resolved –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è —Å root_id=<post.id firing> –≤ —Ç–æ—Ç –∂–µ thread.
